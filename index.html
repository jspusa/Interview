<!DOCTYPE html>
<html lang="zh-Hant">
<head>
  <meta charset="UTF-8" />
  <title>面試評分表</title>
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <style>
    * {
      box-sizing: border-box;
      font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", "PingFang TC",
        "Microsoft JhengHei", sans-serif;
    }

    body {
      margin: 0;
      padding: 28px;
      background: radial-gradient(circle at 20% 20%, #eef2ff 0, transparent 25%),
        radial-gradient(circle at 80% 0, #e0f2fe 0, transparent 25%),
        radial-gradient(circle at 10% 80%, #fdf2f8 0, transparent 22%),
        #f5f6fb;
      color: #0f172a;
    }

    .container {
      max-width: 960px;
      margin: 0 auto;
      background: #ffffff;
      padding: 28px 28px 36px;
      border-radius: 18px;
      box-shadow: 0 20px 40px rgba(15, 23, 42, 0.16);
      border: 1px solid #e2e8f0;
    }

    h1 {
      text-align: center;
      margin-top: 0;
      margin-bottom: 4px;
      font-size: 26px;
      letter-spacing: 0.06em;
    }

    .subtitle {
      text-align: center;
      font-size: 14px;
      color: #475569;
      margin-bottom: 26px;
    }

    .grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
      gap: 12px 18px;
      margin-bottom: 20px;
    }

    .field {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    label {
      font-size: 13px;
      font-weight: 600;
      color: #1f2937;
    }

    input[type="text"],
    input[type="date"],
    select,
    textarea {
      padding: 7px 9px;
      border-radius: 10px;
      border: 1px solid #d7dce3;
      font-size: 13px;
      transition: border-color 0.15s ease, box-shadow 0.15s ease,
        background-color 0.15s ease;
      background: #f8fafc;
    }

    input[type="text"]:focus,
    input[type="date"]:focus,
    select:focus,
    textarea:focus {
      outline: none;
      border-color: #6366f1;
      box-shadow: 0 0 0 3px rgba(129, 140, 248, 0.18);
      background: #ffffff;
    }

    textarea {
      min-height: 80px;
      resize: vertical;
    }

    .section-card {
      border-radius: 16px;
      border: 1px solid #e2e8f0;
      padding: 18px 20px 20px;
      margin-bottom: 18px;
      background: linear-gradient(145deg, #ffffff 0%, #f9fafb 45%, #f8fafc 100%);
      box-shadow: inset 0 1px 0 rgba(255, 255, 255, 0.6);
    }

    .section-header {
      display: flex;
      justify-content: space-between;
      align-items: baseline;
      margin-bottom: 10px;
      border-bottom: 1px dashed #e5e7eb;
      padding-bottom: 6px;
    }

    .section-title {
      font-size: 15px;
      font-weight: 700;
    }

    .section-meta {
      font-size: 12px;
      color: #6b7280;
    }

    .item-row {
      display: grid;
      grid-template-columns: minmax(110px, 140px) 140px 1fr;
      gap: 8px;
      align-items: flex-start;
      padding: 6px 0;
      border-bottom: 1px dashed #f3f4f6;
    }

    .item-row:last-child {
      border-bottom: none;
    }

    .item-label {
      font-size: 13px;
      font-weight: 600;
      color: #374151;
      padding-top: 4px;
    }

    .score-wrapper {
      display: flex;
      flex-direction: column;
      gap: 4px;
    }

    .score-select-row {
      display: flex;
      gap: 4px;
      align-items: center;
      font-size: 12px;
      color: #6b7280;
      flex-wrap: wrap;
    }

    .score-select-row select {
      width: 70px;
    }

    .score-tag {
      font-size: 11px;
      padding: 2px 6px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4f46e5;
      border: 1px solid #e0e7ff;
    }

    .comment-label {
      font-size: 12px;
      color: #6b7280;
    }

    .total-row {
      margin-top: 16px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px 16px;
      align-items: center;
      padding: 10px 12px;
      border-radius: 14px;
      background: #f8fafc;
      border: 1px dashed #d7dce3;
    }

    .total-row label {
      margin-right: 4px;
    }

    .total-score {
      font-size: 18px;
      font-weight: 800;
      color: #0f172a;
      min-width: 60px;
      text-align: center;
    }

    .total-hint {
      font-size: 12px;
      color: #6b7280;
    }

    .actions {
      margin-top: 20px;
      display: flex;
      flex-wrap: wrap;
      gap: 10px;
      justify-content: flex-end;
    }

    button {
      border: none;
      cursor: pointer;
      border-radius: 999px;
      padding: 8px 16px;
      font-size: 13px;
      font-weight: 600;
      display: inline-flex;
      align-items: center;
      gap: 6px;
      transition: transform 0.08s ease, box-shadow 0.08s ease,
        background-color 0.15s ease;
    }

    .btn-primary {
      background: linear-gradient(135deg, #4f46e5, #6366f1);
      color: #ffffff;
      box-shadow: 0 8px 18px rgba(79, 70, 229, 0.35);
    }

    .btn-primary:hover {
      transform: translateY(-1px);
      box-shadow: 0 10px 22px rgba(79, 70, 229, 0.45);
      background: linear-gradient(135deg, #4338ca, #4f46e5);
    }

    .btn-secondary {
      background: #e5e7eb;
      color: #374151;
    }

    .btn-secondary:hover {
      background: #d1d5db;
      transform: translateY(-1px);
    }

    .pill {
      display: inline-flex;
      align-items: center;
      padding: 6px 12px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4338ca;
      font-size: 12px;
      gap: 6px;
    }

    .muted {
      color: #6b7280;
      font-size: 12px;
    }

    .ai-tools-grid {
      display: grid;
      grid-template-columns: repeat(auto-fit, minmax(160px, 1fr));
      gap: 8px 10px;
      margin-top: 8px;
    }

    .chip {
      display: inline-flex;
      align-items: center;
      gap: 6px;
      padding: 6px 10px;
      border-radius: 12px;
      background: #f8fafc;
      border: 1px solid #e2e8f0;
      font-size: 12px;
      color: #1f2937;
    }

    .hidden {
      display: none;
    }

    .disc-box {
      margin-top: 8px;
      padding: 10px 12px;
      border-radius: 12px;
      border: 1px solid #e2e8f0;
      background: #f8fafc;
      color: #1f2937;
      line-height: 1.5;
    }

    .disc-title {
      font-weight: 700;
      margin-bottom: 4px;
      color: #111827;
    }

    .disc-tag {
      display: inline-block;
      margin-bottom: 6px;
      padding: 2px 8px;
      border-radius: 999px;
      background: #eef2ff;
      color: #4338ca;
      font-size: 12px;
      border: 1px solid #e0e7ff;
    }

    small.helper {
      display: block;
      font-size: 11px;
      color: #9ca3af;
      margin-top: 2px;
    }

    @media (max-width: 720px) {
      .item-row {
        grid-template-columns: 1fr;
      }

      .item-label {
        padding-top: 0;
      }
    }
  </style>
</head>
<body>
  <div class="container">
    <h1>面試評分表</h1>
    <div class="subtitle">請依實際面試情況評分與填寫評語，完成後可匯出為 Word 檔。</div>

    <!-- 基本資料 -->
    <div class="grid">
      <div class="field">
        <label for="candidateName">應聘者姓名</label>
        <input type="text" id="candidateName" />
      </div>
      <div class="field">
        <label for="position">面試職位</label>
        <input type="text" id="position" />
      </div>
      <div class="field">
        <label for="interviewDate">面試日期</label>
        <input type="date" id="interviewDate" />
      </div>
      <div class="field">
        <label for="interviewer">面試官姓名</label>
        <input type="text" id="interviewer" />
      </div>
    </div>

    <!-- 候選人自述與 AI/人格補充 -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">候選人自述與補充資訊</div>
        <div class="section-meta">幫助面試官快速捕捉個人亮點</div>
      </div>

      <div class="grid">
        <div class="field">
          <label for="self_strength">候選人自述的優點</label>
          <textarea id="self_strength" placeholder="例如：擅長跨部門溝通、能快速拆解需求、喜歡學習新工具……"></textarea>
        </div>
        <div class="field">
          <label for="self_weakness">候選人自述的待改進處</label>
          <textarea id="self_weakness" placeholder="例如：希望加強數據分析、需要更多大型專案經驗……"></textarea>
        </div>
      </div>

      <div class="grid">
        <div class="field">
          <label>是否有使用 AI 軟體？</label>
          <div class="score-select-row" style="gap:10px;">
            <label class="chip"><input type="radio" name="ai_usage" value="yes" /> 有</label>
            <label class="chip"><input type="radio" name="ai_usage" value="no" /> 沒有</label>
            <span class="muted">若勾選「有」，可勾選常用工具</span>
          </div>
          <div id="aiToolsWrapper" class="ai-tools-grid hidden">
            <label class="chip"><input type="checkbox" class="ai-tool" value="ChatGPT" /> ChatGPT</label>
            <label class="chip"><input type="checkbox" class="ai-tool" value="Adobe" /> Adobe</label>
            <label class="chip"><input type="checkbox" class="ai-tool" value="Canva" /> Canva</label>
            <label class="chip"><input type="checkbox" class="ai-tool" value="Gemini" /> Gemini</label>
            <label class="chip"><input type="checkbox" class="ai-tool" value="Notion AI" /> Notion AI</label>
            <label class="chip"><input type="checkbox" class="ai-tool" value="Microsoft Copilot" /> Microsoft Copilot</label>
            <div class="field" style="grid-column: 1 / -1; margin-top:4px;">
              <label for="ai_other" class="muted">其他常用 AI（可輸入）</label>
              <input type="text" id="ai_other" placeholder="請填寫其他工具名稱或使用情境" />
            </div>
          </div>
        </div>

        <div class="field">
          <label for="disc_type">DISC 人格測驗結果</label>
          <select id="disc_type">
            <option value="">— 請選擇 —</option>
            <option value="D">支配型（D）- 老虎</option>
            <option value="I">影響型（I）- 孔雀</option>
            <option value="S">穩健型（S）- 無尾熊</option>
            <option value="C">謹慎型（C）- 貓頭鷹</option>
          </select>
          <div id="discResult" class="disc-box">
            <div class="disc-title">尚未選擇</div>
            <div class="muted">選擇 DISC 類型後，系統會自動帶出人格特質與適合的職場情境，方便記錄在 Word。</div>
          </div>
        </div>
      </div>
    </div>

    <!-- 一、基本信息 -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">一、基本信息</div>
        <div class="section-meta">每項滿分 5 分</div>
      </div>

      <div class="item-row">
        <div class="item-label">履歷完整度</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–5 分</span>
            <label for="basic_resume_score">評分</label>
            <select id="basic_resume_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option>
            </select>
          </div>
          <small class="helper">履歷是否清楚、完整呈現與職位相關資訊</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="basic_resume_comment"></textarea>
        </div>
      </div>

      <div class="item-row">
        <div class="item-label">教育背景</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–5 分</span>
            <label for="basic_edu_score">評分</label>
            <select id="basic_edu_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option>
            </select>
          </div>
          <small class="helper">學歷是否符合職位需求，專業相關性</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="basic_edu_comment"></textarea>
        </div>
      </div>

      <div class="item-row">
        <div class="item-label">工作經歷</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–5 分</span>
            <label for="basic_exp_score">評分</label>
            <select id="basic_exp_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option>
            </select>
          </div>
          <small class="helper">過往經歷與職務內容之匹配程度</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="basic_exp_comment"></textarea>
        </div>
      </div>
    </div>

    <!-- 二、專業能力 -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">二、專業能力</div>
        <div class="section-meta">每項滿分 10 分</div>
      </div>

      <div class="item-row">
        <div class="item-label">技術技能</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–10 分</span>
            <label for="pro_tech_score">評分</label>
            <select id="pro_tech_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option><option>6</option>
              <option>7</option><option>8</option><option>9</option>
              <option>10</option>
            </select>
          </div>
          <small class="helper">專業技能熟練度、工具與系統使用能力</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="pro_tech_comment"></textarea>
        </div>
      </div>

      <div class="item-row">
        <div class="item-label">問題解決能力</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–10 分</span>
            <label for="pro_problem_score">評分</label>
            <select id="pro_problem_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option><option>6</option>
              <option>7</option><option>8</option><option>9</option>
              <option>10</option>
            </select>
          </div>
          <small class="helper">面對情境題或實際問題時的分析與解法</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="pro_problem_comment"></textarea>
        </div>
      </div>

      <div class="item-row">
        <div class="item-label">學習能力</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–10 分</span>
            <label for="pro_learning_score">評分</label>
            <select id="pro_learning_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option><option>6</option>
              <option>7</option><option>8</option><option>9</option>
              <option>10</option>
            </select>
          </div>
          <small class="helper">新知學習速度、主動性與應用能力</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="pro_learning_comment"></textarea>
        </div>
      </div>
    </div>

    <!-- 三、軟技能 -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">三、軟技能</div>
        <div class="section-meta">每項滿分 10 分</div>
      </div>

      <div class="item-row">
        <div class="item-label">溝通能力</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–10 分</span>
            <label for="soft_comm_score">評分</label>
            <select id="soft_comm_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option><option>6</option>
              <option>7</option><option>8</option><option>9</option>
              <option>10</option>
            </select>
          </div>
          <small class="helper">表達清楚度、傾聽及雙向溝通效果</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="soft_comm_comment"></textarea>
        </div>
      </div>

      <div class="item-row">
        <div class="item-label">團隊合作</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–10 分</span>
            <label for="soft_team_score">評分</label>
            <select id="soft_team_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option><option>6</option>
              <option>7</option><option>8</option><option>9</option>
              <option>10</option>
            </select>
          </div>
          <small class="helper">與同事協作、分享與支援程度</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="soft_team_comment"></textarea>
        </div>
      </div>

      <div class="item-row">
        <div class="item-label">時間管理</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–10 分</span>
            <label for="soft_time_score">評分</label>
            <select id="soft_time_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option><option>6</option>
              <option>7</option><option>8</option><option>9</option>
              <option>10</option>
            </select>
          </div>
          <small class="helper">優先順序安排、準時與交付狀況</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="soft_time_comment"></textarea>
        </div>
      </div>

      <div class="item-row">
        <div class="item-label">抗壓能力</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–10 分</span>
            <label for="soft_stress_score">評分</label>
            <select id="soft_stress_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option><option>6</option>
              <option>7</option><option>8</option><option>9</option>
              <option>10</option>
            </select>
          </div>
          <small class="helper">面對壓力、突發狀況時的穩定度</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="soft_stress_comment"></textarea>
        </div>
      </div>
    </div>

    <!-- 四、面試表現 -->
    <div class="section-card">
      <div class="section-header">
        <div class="section-title">四、面試表現</div>
        <div class="section-meta">每項滿分 5 分</div>
      </div>

      <div class="item-row">
        <div class="item-label">應對能力</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–5 分</span>
            <label for="perf_response_score">評分</label>
            <select id="perf_response_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option>
            </select>
          </div>
          <small class="helper">對問題反應速度、思路清晰度</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="perf_response_comment"></textarea>
        </div>
      </div>

      <div class="item-row">
        <div class="item-label">職業態度</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–5 分</span>
            <label for="perf_attitude_score">評分</label>
            <select id="perf_attitude_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option>
            </select>
          </div>
          <small class="helper">對工作熱忱、穩定度及價值觀</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="perf_attitude_comment"></textarea>
        </div>
      </div>

      <div class="item-row">
        <div class="item-label">儀表儀態</div>
        <div class="score-wrapper">
          <div class="score-select-row">
            <span class="score-tag">1–5 分</span>
            <label for="perf_manner_score">評分</label>
            <select id="perf_manner_score" class="score-input" data-field>
              <option value="">—</option>
              <option>1</option><option>2</option><option>3</option>
              <option>4</option><option>5</option>
            </select>
          </div>
          <small class="helper">穿著、禮貌及整體專業形象</small>
        </div>
        <div>
          <div class="comment-label">評語</div>
          <textarea id="perf_manner_comment"></textarea>
        </div>
      </div>
    </div>

    <!-- 總評 -->
    <div class="section-card">
      <div class="total-row">
        <div style="display:flex;align-items:center;gap:6px;">
          <label>總分(滿分 100 分)：</label>
          <div class="total-score" id="totalScore">—</div>
        </div>
        <div class="total-hint">
          系統會自動加總所有評分。若有未填寫的項目，總分會略低於 100 分。
        </div>
      </div>

      <div style="margin-top:12px;">
        <div class="field">
          <label for="overall_comment">總評 — 綜合評價及建議</label>
            <textarea id="overall_comment" placeholder="例如：整體專業能力佳，建議錄用／可列入備選名單／暫不適合該職位等。"></textarea>
        </div>
      </div>

      <div style="margin-top:12px;" class="grid">
        <div class="field">
          <label for="signature">面試官簽名（可輸入姓名，Word 中可再手簽）：</label>
          <input type="text" id="signature" />
        </div>
      </div>
    </div>

    <!-- 操作按鈕 -->
    <div class="actions">
      <button type="button" class="btn-secondary" onclick="resetForm()">
        重置表單
      </button>
      <button type="button" class="btn-primary" onclick="exportToWord()">
        匯出為 Word
      </button>
    </div>
  </div>

  <script>
    // 自動計算總分
    const scoreInputs = document.querySelectorAll(".score-input");
    const totalScoreEl = document.getElementById("totalScore");
    const aiUsageInputs = document.querySelectorAll("input[name='ai_usage']");
    const aiToolsWrapper = document.getElementById("aiToolsWrapper");
    const aiToolCheckboxes = document.querySelectorAll(".ai-tool");
    const aiOtherInput = document.getElementById("ai_other");
    const discSelect = document.getElementById("disc_type");
    const discResult = document.getElementById("discResult");

    const discDescriptions = {
      D: {
        title: "支配型（D）- 老虎",
        traits:
          "目標導向、行動迅速、有決斷力，喜歡挑戰並勇於承擔風險。",
        jobs:
          "領導者、管理者、危機處理、專案推動、需要達成目標的銷售或開發職位。"
      },
      I: {
        title: "影響型（I）- 孔雀",
        traits:
          "熱情有活力、善於溝通、能激勵他人，樂於在團隊中互動。",
        jobs:
          "業務、行銷、公關、人資、需要大量人際互動與協作的職位。"
      },
      S: {
        title: "穩健型（S）- 無尾熊",
        traits:
          "冷靜溫和、處事圓融、忠誠可信賴，偏好穩定可預測的工作步調。",
        jobs:
          "客戶服務、教育、行政、團隊合作型的專案支援，或是在領導帶領下執行任務。"
      },
      C: {
        title: "謹慎型（C）- 貓頭鷹",
        traits:
          "邏輯性強、分析力佳、細心謹慎，重視規則與細節。",
        jobs:
          "財務、會計、專案管理、研究員、品管等需要精確性和分析力的工作。"
      }
    };

    function updateTotalScore() {
      let total = 0;
      scoreInputs.forEach((sel) => {
        const val = parseInt(sel.value, 10);
        if (!isNaN(val)) total += val;
      });
      totalScoreEl.textContent = total > 0 ? total : "—";
    }

    scoreInputs.forEach((sel) => {
      sel.addEventListener("change", updateTotalScore);
    });

    function updateAiToolsVisibility() {
      const usingAi =
        (document.querySelector("input[name='ai_usage']:checked") || {})
          .value === "yes";
      aiToolsWrapper.classList.toggle("hidden", !usingAi);
      if (!usingAi) {
        aiToolCheckboxes.forEach((cb) => (cb.checked = false));
        aiOtherInput.value = "";
      }
      return usingAi;
    }

    aiUsageInputs.forEach((input) =>
      input.addEventListener("change", updateAiToolsVisibility)
    );

    function getSelectedAiTools() {
      const tools = Array.from(aiToolCheckboxes)
        .filter((cb) => cb.checked)
        .map((cb) => cb.value);
      if (aiOtherInput.value.trim()) tools.push(aiOtherInput.value.trim());
      return tools;
    }

    function updateDiscInfo() {
      const type = discSelect.value;
      const info = discDescriptions[type];
      if (!info) {
        discResult.innerHTML =
          '<div class="disc-title">尚未選擇</div><div class="muted">選擇 DISC 類型後，系統會自動帶出人格特質與適合的職場情境，方便記錄在 Word。</div>';
        return;
      }

      discResult.innerHTML = `
        <div class="disc-tag">${info.title}</div>
        <div class="disc-title">人格特質</div>
        <div>${info.traits}</div>
        <div class="disc-title" style="margin-top:6px;">適合的職場情境</div>
        <div>${info.jobs}</div>
      `;
    }

    discSelect.addEventListener("change", updateDiscInfo);

    function resetForm() {
      if (!confirm("確定要清空整份評分表嗎？")) return;
      document.querySelectorAll("input, textarea, select").forEach((el) => {
        if (el.tagName === "SELECT") {
          el.value = "";
        } else {
          el.value = "";
        }
      });
      document
        .querySelectorAll("input[name='ai_usage']")
        .forEach((radio) => (radio.checked = false));
      aiToolCheckboxes.forEach((cb) => (cb.checked = false));
      aiOtherInput.value = "";
      updateTotalScore();
      updateAiToolsVisibility();
      updateDiscInfo();
    }

    function safeText(text) {
      if (!text) return "";
      return text.replace(/&/g, "&amp;")
                 .replace(/</g, "&lt;")
                 .replace(/>/g, "&gt;")
                 .replace(/"/g, "&quot;");
    }

    function formatMultiline(text) {
      return safeText(text || "").replace(/\n/g, "<br>");
    }

    function exportToWord() {
      updateTotalScore();

      const data = {
        candidateName: document.getElementById("candidateName").value || "",
        position: document.getElementById("position").value || "",
        interviewDate: document.getElementById("interviewDate").value || "",
        interviewer: document.getElementById("interviewer").value || "",
        self_strength: document.getElementById("self_strength").value,
        self_weakness: document.getElementById("self_weakness").value,
        ai_usage:
          (document.querySelector("input[name='ai_usage']:checked") || {})
            .value || "",
        ai_tools: getSelectedAiTools(),
        ai_other: aiOtherInput.value,
        disc_type: discSelect.value,
        // 基本信息
        basic_resume_score: document.getElementById("basic_resume_score").value,
        basic_resume_comment: document.getElementById("basic_resume_comment").value,
        basic_edu_score: document.getElementById("basic_edu_score").value,
        basic_edu_comment: document.getElementById("basic_edu_comment").value,
        basic_exp_score: document.getElementById("basic_exp_score").value,
        basic_exp_comment: document.getElementById("basic_exp_comment").value,
        // 專業能力
        pro_tech_score: document.getElementById("pro_tech_score").value,
        pro_tech_comment: document.getElementById("pro_tech_comment").value,
        pro_problem_score: document.getElementById("pro_problem_score").value,
        pro_problem_comment: document.getElementById("pro_problem_comment").value,
        pro_learning_score: document.getElementById("pro_learning_score").value,
        pro_learning_comment: document.getElementById("pro_learning_comment").value,
        // 軟技能
        soft_comm_score: document.getElementById("soft_comm_score").value,
        soft_comm_comment: document.getElementById("soft_comm_comment").value,
        soft_team_score: document.getElementById("soft_team_score").value,
        soft_team_comment: document.getElementById("soft_team_comment").value,
        soft_time_score: document.getElementById("soft_time_score").value,
        soft_time_comment: document.getElementById("soft_time_comment").value,
        soft_stress_score: document.getElementById("soft_stress_score").value,
        soft_stress_comment: document.getElementById("soft_stress_comment").value,
        // 面試表現
        perf_response_score: document.getElementById("perf_response_score").value,
        perf_response_comment: document.getElementById("perf_response_comment").value,
        perf_attitude_score: document.getElementById("perf_attitude_score").value,
        perf_attitude_comment: document.getElementById("perf_attitude_comment").value,
        perf_manner_score: document.getElementById("perf_manner_score").value,
        perf_manner_comment: document.getElementById("perf_manner_comment").value,
        // 總評與簽名
        totalScore: totalScoreEl.textContent === "—" ? "" : totalScoreEl.textContent,
        overall_comment: document.getElementById("overall_comment").value,
        signature: document.getElementById("signature").value
      };

      const discInfo = discDescriptions[data.disc_type] || {};
      const aiUsageLabel =
        data.ai_usage === "yes" ? "有" : data.ai_usage === "no" ? "沒有" : "";
      const aiToolsDisplay =
        data.ai_tools && data.ai_tools.length > 0
          ? data.ai_tools.join("、")
          : data.ai_usage === "yes"
            ? "已使用，但未勾選具體工具"
            : "";

      // 把日期轉成比較好看的格式（YYYY-MM-DD -> YYYY/MM/DD）
      let dateDisplay = data.interviewDate;
      if (dateDisplay && dateDisplay.indexOf("-") > -1) {
        const parts = dateDisplay.split("-");
        dateDisplay = parts[0] + "/" + parts[1] + "/" + parts[2];
      }

      const htmlContent = `
<!DOCTYPE html>
<html lang="zh-Hant">
<head>
<meta charset="UTF-8">
<title>面試評分表</title>
<style>
body {
  font-family: "Microsoft JhengHei", "PingFang TC", sans-serif;
  font-size: 12pt;
  line-height: 1.6;
}
 table {
   width: 100%;
   border-collapse: collapse;
   table-layout: fixed;
 }
 td {
   padding: 4px 6px;
   vertical-align: top;
   word-wrap: break-word;
   word-break: break-all;
   white-space: pre-wrap;
 }
.section-title {
  font-weight: bold;
  margin-top: 8px;
  margin-bottom: 4px;
}
.hr-line {
  border-bottom: 1px solid #000;
  margin: 4px 0 6px 0;
}
.signature-line {
  margin-top: 24px;
}
.box-line {
  border-top: 1px solid #000;
  margin: 12px 0;
}
.score-cell {
  width: 120px;
}
.comment-cell {
  width: auto;
}
th, td.border {
  border: 1px solid #000;
}
th {
  background: #f3f4f6;
}
.tag {
  display: inline-block;
  padding: 2px 8px;
  border-radius: 999px;
  background: #eef2ff;
  border: 1px solid #e0e7ff;
}
</style>
</head>
<body>
  <h2 style="text-align:center;">面試評分表</h2>

  <table style="margin-bottom:4px;">
    <tr>
      <td>應聘者姓名：${safeText(data.candidateName)}</td>
      <td>面試職位：${safeText(data.position)}</td>
    </tr>
    <tr>
      <td>面試日期：${safeText(dateDisplay)}</td>
      <td>面試官姓名：${safeText(data.interviewer)}</td>
    </tr>
  </table>

  <div class="section-title">候選人自述與補充資訊</div>
  <table>
    <tr>
      <th class="border">自述優點</th>
      <td class="border">${formatMultiline(data.self_strength)}</td>
    </tr>
    <tr>
      <th class="border">自述待改進處</th>
      <td class="border">${formatMultiline(data.self_weakness)}</td>
    </tr>
    <tr>
      <th class="border">AI 軟體使用</th>
      <td class="border">${safeText(aiUsageLabel)}${aiToolsDisplay ? `｜工具：${safeText(aiToolsDisplay)}` : ""}</td>
    </tr>
    <tr>
      <th class="border">DISC 人格</th>
      <td class="border">
        ${safeText(discInfo.title || "")}
        ${discInfo.traits ? `<div>特質：${safeText(discInfo.traits)}</div>` : ""}
        ${discInfo.jobs ? `<div>適合工作：${safeText(discInfo.jobs)}</div>` : ""}
      </td>
    </tr>
  </table>

  <div class="box-line"></div>

  <div class="section-title">一、基本信息（每項滿分 5 分）</div>
  <table>
    <tr>
      <th class="border">項目</th>
      <th class="border">評分</th>
      <th class="border">評語</th>
    </tr>
    <tr>
      <td class="border">履歷完整度</td>
      <td class="border score-cell">${safeText(data.basic_resume_score)}</td>
      <td class="border">${formatMultiline(data.basic_resume_comment)}</td>
    </tr>
    <tr>
      <td class="border">教育背景</td>
      <td class="border score-cell">${safeText(data.basic_edu_score)}</td>
      <td class="border">${formatMultiline(data.basic_edu_comment)}</td>
    </tr>
    <tr>
      <td class="border">工作經歷</td>
      <td class="border score-cell">${safeText(data.basic_exp_score)}</td>
      <td class="border">${formatMultiline(data.basic_exp_comment)}</td>
    </tr>
  </table>

  <div class="section-title">二、專業能力（每項滿分 10 分）</div>
  <table>
    <tr>
      <th class="border">項目</th>
      <th class="border">評分</th>
      <th class="border">評語</th>
    </tr>
    <tr>
      <td class="border">技術技能</td>
      <td class="border score-cell">${safeText(data.pro_tech_score)}</td>
      <td class="border">${formatMultiline(data.pro_tech_comment)}</td>
    </tr>
    <tr>
      <td class="border">問題解決能力</td>
      <td class="border score-cell">${safeText(data.pro_problem_score)}</td>
      <td class="border">${formatMultiline(data.pro_problem_comment)}</td>
    </tr>
    <tr>
      <td class="border">學習能力</td>
      <td class="border score-cell">${safeText(data.pro_learning_score)}</td>
      <td class="border">${formatMultiline(data.pro_learning_comment)}</td>
    </tr>
  </table>

  <div class="section-title">三、軟技能（每項滿分 10 分）</div>
  <table>
    <tr>
      <th class="border">項目</th>
      <th class="border">評分</th>
      <th class="border">評語</th>
    </tr>
    <tr>
      <td class="border">溝通能力</td>
      <td class="border score-cell">${safeText(data.soft_comm_score)}</td>
      <td class="border">${formatMultiline(data.soft_comm_comment)}</td>
    </tr>
    <tr>
      <td class="border">團隊合作</td>
      <td class="border score-cell">${safeText(data.soft_team_score)}</td>
      <td class="border">${formatMultiline(data.soft_team_comment)}</td>
    </tr>
    <tr>
      <td class="border">時間管理</td>
      <td class="border score-cell">${safeText(data.soft_time_score)}</td>
      <td class="border">${formatMultiline(data.soft_time_comment)}</td>
    </tr>
    <tr>
      <td class="border">抗壓能力</td>
      <td class="border score-cell">${safeText(data.soft_stress_score)}</td>
      <td class="border">${formatMultiline(data.soft_stress_comment)}</td>
    </tr>
  </table>

  <div class="section-title">四、面試表現（每項滿分 5 分）</div>
  <table>
    <tr>
      <th class="border">項目</th>
      <th class="border">評分</th>
      <th class="border">評語</th>
    </tr>
    <tr>
      <td class="border">應對能力</td>
      <td class="border score-cell">${safeText(data.perf_response_score)}</td>
      <td class="border">${formatMultiline(data.perf_response_comment)}</td>
    </tr>
    <tr>
      <td class="border">職業態度</td>
      <td class="border score-cell">${safeText(data.perf_attitude_score)}</td>
      <td class="border">${formatMultiline(data.perf_attitude_comment)}</td>
    </tr>
    <tr>
      <td class="border">儀表儀態</td>
      <td class="border score-cell">${safeText(data.perf_manner_score)}</td>
      <td class="border">${formatMultiline(data.perf_manner_comment)}</td>
    </tr>
  </table>

  <div class="box-line"></div>

  <p><strong>總分（滿分 100 分）：</strong> ${safeText(data.totalScore)}</p>

  <p><strong>總評 — 綜合評價及建議：</strong></p>
  <p>${formatMultiline(data.overall_comment)}</p>

  <div class="box-line"></div>

  <p class="signature-line">
    面試官簽名： __________________________
    &nbsp;&nbsp;&nbsp;&nbsp;
    （姓名：${safeText(data.signature)}）
  </p>

</body>
</html>
      `;

      const blob = new Blob(["\ufeff", htmlContent], {
        type: "application/msword;charset=utf-8"
      });

      let filename = "面試評分表";
      if (data.candidateName) {
        filename += "-" + data.candidateName;
      }
      filename += ".doc";

      const url = URL.createObjectURL(blob);
      const link = document.createElement("a");
      link.href = url;
      link.download = filename;
      document.body.appendChild(link);
      link.click();
      document.body.removeChild(link);
      URL.revokeObjectURL(url);
    }

    updateTotalScore();
    updateAiToolsVisibility();
    updateDiscInfo();
  </script>
</body>
</html>
